unit GrupoRelatorios;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, CadBasico, DB, cxGridLevel, cxGridDBTableView, cxGrid, DBClient,
  cxDBEdit, cxContainer, cxLabel, cxSplitter,
  Menus, Data.FMTBcd, cxControls, cxEdit,

  cxGridCustomTableView, cxGridTableView, cxClasses, cxGridCustomView,
  cxTextEdit, Datasnap.Provider, Data.SqlExpr, System.Actions, Vcl.ActnList,
  Vcl.ComCtrls, Vcl.StdCtrls, cxButtons, Vcl.ExtCtrls, cxGraphics,
  cxLookAndFeels, cxLookAndFeelPainters, cxStyles, cxCustomData, cxFilter,
  cxData, cxDataStorage, cxNavigator, cxDBData;
type
  TfrmGrupoRelatorio = class(TfrmCadBasico)
    grdGrupoRelatorio: TcxGrid;
    grdGrupoRelatorioDBTableView1: TcxGridDBTableView;
    grdGrupoRelatorioLevel1: TcxGridLevel;
    cxLabel2: TcxLabel;
    cxLabel1: TcxLabel;
    ClientAncestralGRUPO_RELATORIO_ID: TFMTBCDField;
    ClientAncestralDESCRICAO: TStringField;
    ClientAncestralSISTEMA_ID: TFMTBCDField;
    cxSplitter1: TcxSplitter;
    grdGrupoRelatorioDBTableView1GRUPO_RELATORIO_ID: TcxGridDBColumn;
    grdGrupoRelatorioDBTableView1DESCRICAO: TcxGridDBColumn;
    edtCodigo: TcxDBTextEdit;
    edtDescricao: TcxDBTextEdit;
    procedure ExecuteGravarExecute(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure ExecuteIncluirExecute(Sender: TObject);
    procedure ExecuteAlterarExecute(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure ExecutePesquisaExecute(Sender: TObject);
  private
    vlID : Integer;
  public
    { Public declarations }
    procedure LoadData; override;
    procedure SetState (AState : TDataSetState);override;
  end;

var
  frmGrupoRelatorio: TfrmGrupoRelatorio;

implementation

uses Controles, Pesquisa;

{$R *.dfm}

procedure TfrmGrupoRelatorio.ExecuteGravarExecute(Sender: TObject);
begin
  ClientAncestralSISTEMA_ID.AsInteger := vlID;
  inherited;

end;

procedure TfrmGrupoRelatorio.FormCreate(Sender: TObject);
begin
  inherited;
  if vgId = 20 then
       vlID := 5
  else vlID := vgId;

  DataSetAncestral.Params[0].AsInteger := vlID;

  if vlID = 5 then
       DataSetAncestral.Params[1].AsInteger := 17
  else DataSetAncestral.Params[1].AsInteger := vlID;

  ClientAncestral.Open;
  vgNomeTabela    := 'G_GRUPO_RELATORIO';
  vgChavePrimaria := 'GRUPO_RELATORIO_ID';

end;

procedure TfrmGrupoRelatorio.LoadData;
begin
  if Trim(vgChave) <> '' then
     ClientAncestral.Locate('GRUPO_RELATORIO_ID', vgChave, [loCaseInsensitive]);
  inherited;

end;

procedure TfrmGrupoRelatorio.SetState(AState: TDataSetState);
begin
  inherited;
  grdGrupoRelatorio.Enabled := State = dsBrowse;
end;

procedure TfrmGrupoRelatorio.ExecuteIncluirExecute(Sender: TObject);
begin
  inherited;
  edtDescricao.SetFocus;
end;

procedure TfrmGrupoRelatorio.ExecuteAlterarExecute(Sender: TObject);
begin
  inherited;
  edtDescricao.SetFocus;
end;

procedure TfrmGrupoRelatorio.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
  inherited;
  Action            := caFree;
  frmGrupoRelatorio := nil;
end;

procedure TfrmGrupoRelatorio.ExecutePesquisaExecute(Sender: TObject);
begin
  inherited;
  vgChave := PesqGrupoRelatorio;
  LoadData;
end;

end.
